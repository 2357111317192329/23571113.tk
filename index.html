<!DOCTYPE html>
<html>
<body>
<h1>Hello Bonk</h1>
  <iframe id="myIframe" width="920" height="625"></iframe>
  <p id="ale">請先通過機器人測試</p>
<p>Simulating bonk.io</p>
<h2>如果喜歡，歡迎<a href="https://www.paypal.com/paypalme/2357111317192329/1">捐款</a></h2>
<h3>機器人測試</h3>
  驗證碼
  <img id="myImg" src="Logo_of_Twitter.png" width="320" height="80" style="display: inline;">
  <canvas id="myCanvas" width="320" height="80" style="border:1px solid #d3d3d3; display: inline;"></canvas>
  <button onclick="location.reload();">換一個</button>
  <br>
  請輸入驗證碼: <input type="text" id="userInput">
  <button onclick="checkInput()">提交</button>
  <p id="result"></p>
<script>
  var lastupdate;
  function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  function getRandomColor() {
      var letters = '0123456789ABCDEF';
      var color = '#';
      for (var i = 0; i < 6; i++) {
          color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
  }
  function getContrastColor(color) {
      color = color.substring(1);
      var r = parseInt(color.substring(0, 2), 16);
      var g = parseInt(color.substring(2, 4), 16);
      var b = parseInt(color.substring(4, 6), 16);
      var newr=getRandomInt(0, 255);
      var newg=getRandomInt(0, 255);
      var newb=getRandomInt(0, 255);
      while((Math.abs(r-newr)<40)||((Math.abs(r-newr)>80))){
        newr=getRandomInt(0, 255);
      }
      while((Math.abs(g-newg)<40)||((Math.abs(g-newg)>80))){
        newg=getRandomInt(0, 255);
      }
      while((Math.abs(b-newb)<40)||((Math.abs(b-newb)>80))){
        newb=getRandomInt(0, 255);
      }
      r = newr.toString(16);
      g = newg.toString(16);
      b = newb.toString(16);
      if (r.length < 2) r = "0" + r;
      if (g.length < 2) g = "0" + g;
      if (b.length < 2) b = "0" + b;
      var contrastColor = "#" + r + g + b;
      return contrastColor;
  }
  var typ = getRandomInt(0, 19);
  var randomNumber = "";
  for (var i = 0; i < 4; i++) {
      var tmp=getRandomInt(48, 122);
      while((tmp==59)||(tmp==91)||(tmp==93)||(tmp==96)){
        tmp=getRandomInt(48, 122)
      }
      tmp=String.fromCharCode(tmp)
      randomNumber+=tmp;
  };
  
  var canvas = document.getElementById("myCanvas");
  if(typ>0){
    window.onload = function() {
      var ctx = canvas.getContext("2d");
      var myColor[4]={getRandomColor(),getRandomColor(),getRandomColor(),getRandomColor()};
      var contrastColor[4]={getRandomColor(),getRandomColor(),getRandomColor(),getRandomColor()};
      for (var i = 0; i < 4; i++) {
        contrastColor[i] = getContrastColor(myColor[i]);
      };
      var img = document.getElementById("myImg");
      img.style.display = "none";
      var grd = ctx.createLinearGradient(0, 0,320,80);
      grd.addColorStop(0, myColor[0]);
      grd.addColorStop(0.33, myColor[1]);
      grd.addColorStop(0.67, myColor[2]);
      grd.addColorStop(1, myColor[3]);
      ctx.fillStyle = grd;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.font = "bold "+getRandomInt(70, 90)+"px Source Code";
      ctx.textAlign = "center"; 
      ctx.textBaseline = "middle";
      for (var i = 0; i < 4; i++) {
        var x = 40 + i * 80; 
        ctx.fillStyle = getContrastColor(myColor);
        ctx.fillText(randomNumber[i], x, canvas.height / 2);
      };
      var numSpaghetti = 60;
      //ctx.strokeStyle = getContrastColor(myColor);
      for (var i = 0; i < numSpaghetti; i++) {
        var x = Math.random() * canvas.width;
        var y = Math.random() * canvas.height;
        var endX = x + (Math.random() - 0.5) * 30;
        var endY = y + (Math.random() - 0.5) * 30;
        ctx.beginPath();
        ctx.moveTo(x, y);
        ctx.strokeStyle = getRandomColor();
        ctx.lineTo(endX, endY);
        ctx.stroke();
      }
      var ia = ctx.getImageData(0, 0, canvas.width, canvas.height);
      var dta = ia.data;
      var r=getRandomInt(86,125);
      for (var i = 0; i < dta.length; i += 4) {
        var delr=getRandomInt(-r, r);
        var delg=getRandomInt(-r, r);
        var delb=getRandomInt(-r, r);
        var newr=Math.min(Math.max(0, dta[i] + delr),255);
        var newg=Math.min(Math.max(0, dta[i+1] + delg),255);
        var newb=Math.min(Math.max(0, dta[i+2] + delb),255);
        dta[i] = newr;  
        dta[i + 1] = newg;
        dta[i + 2] = newb;
      }
      ctx.putImageData(ia, 0, 0);
    }
  }
  else{
    canvas.style.display = "none";
    var img = document.getElementById("myImg");
    img.style.display = "block";
    randomNumber = "Google";
  }

function checkInput() {
  var userInput = document.getElementById("userInput").value;
  if (userInput == randomNumber) {
    document.getElementById("result").innerHTML = "通過機器人測試";
    var iframe = document.getElementById("myIframe"); 
    iframe.src = "https://www.greenfoot.org/scenarios/28272?embed=true"; 
    var text = document.getElementById("ale");
    text.style.display = "none"; 
  } else {
    document.getElementById("result").innerHTML = "你是機器人<br>將在2秒後自動重新載入";
    setTimeout(function() {
      location.reload();
    }, 2000);
  }
}
lastupdate=document.lastModified
document.write("本網頁最後修改時間為：" + lastupdate)
</script>
</body>
</html>
